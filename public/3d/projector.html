<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Projector 3D</title><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#000;font:12px/1.4 system-ui,sans-serif}#info{position:absolute;top:8px;left:10px;color:#fff;font-size:11px;z-index:10;font-weight:500}canvas{display:block;outline:0}#stats{position:absolute;top:0;right:0} .lil-gui{--background-color:#111!important;--title-background-color:#181818!important;--widget-color:#222!important;--title-text-color:#fff!important;--text-color:#ddd!important;}</style>
</head><body>
<div id="info"><a href="https://threejs.org" target="_blank" rel="noopener" style="color:#6bf;text-decoration:none">three.js</a> projector light</div>
<script type="importmap">{"imports":{"three":"https://unpkg.com/three@0.167.0/build/three.webgpu.js","three/webgpu":"https://unpkg.com/three@0.167.0/build/three.webgpu.js","three/tsl":"https://unpkg.com/three@0.167.0/build/three.tsl.js","three/addons/":"https://unpkg.com/three@0.167.0/examples/jsm/"}}</script>
<video id="video" loop muted crossOrigin="anonymous" playsinline style="display:none">
<source src="https://threejs.org/examples/textures/sintel.ogv" type='video/ogg; codecs="theora, vorbis"'>
<source src="https://threejs.org/examples/textures/sintel.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
</video>
<script type="module">
import * as THREE from 'three/webgpu';
import { Fn, color, mx_worley_noise_float, time } from 'three/tsl';
import { PLYLoader } from 'three/addons/loaders/PLYLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import Stats from 'three/addons/libs/stats.module.js';
import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
let renderer, scene, camera, projectorLight, lightHelper, stats;
init();
function init(){
 stats=new Stats();document.body.appendChild(stats.dom);
 renderer=new THREE.WebGPURenderer({antialias:true});
 renderer.setPixelRatio(window.devicePixelRatio);
 resize();
 renderer.setAnimationLoop(animate);
 document.body.appendChild(renderer.domElement);
 renderer.shadowMap.enabled=true;renderer.shadowMap.type=THREE.PCFSoftShadowMap;
 renderer.toneMapping=THREE.ACESFilmicToneMapping;renderer.toneMappingExposure=1;
 scene=new THREE.Scene();
 camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,0.1,100);
 camera.position.set(7,4,1);
 const controls=new OrbitControls(camera,renderer.domElement);controls.minDistance=2;controls.maxDistance=10;controls.maxPolarAngle=Math.PI/2;controls.target.set(0,1,0);controls.update();
 const loader=new THREE.TextureLoader();
 const causticEffect=Fn(([projectorUV])=>{const waterLayer0=mx_worley_noise_float(projectorUV.mul(10).add(time));return waterLayer0.mul(color(0x5abcd8)).mul(2);});
 const ambient=new THREE.HemisphereLight(0xffffff,0x8d8d8d,0.15);scene.add(ambient);
 projectorLight=new THREE.ProjectorLight(0xffffff,100);projectorLight.colorNode=causticEffect;projectorLight.position.set(2.5,5,2.5);projectorLight.angle=Math.PI/6;projectorLight.penumbra=1;projectorLight.decay=2;projectorLight.distance=0;projectorLight.castShadow=true;projectorLight.shadow.mapSize.width=1024;projectorLight.shadow.mapSize.height=1024;projectorLight.shadow.camera.near=1;projectorLight.shadow.camera.far=10;projectorLight.shadow.focus=1;projectorLight.shadow.bias=-.003;scene.add(projectorLight);
 lightHelper=new THREE.SpotLightHelper(projectorLight);scene.add(lightHelper);
 const plane=new THREE.Mesh(new THREE.PlaneGeometry(200,200),new THREE.MeshLambertMaterial({color:0xbcbcbc}));plane.position.set(0,-1,0);plane.rotation.x=-Math.PI/2;plane.receiveShadow=true;scene.add(plane);
 new PLYLoader().load('https://threejs.org/examples/models/ply/binary/Lucy100k.ply',g=>{g.scale(.0024,.0024,.0024);g.computeVertexNormals();const m=new THREE.MeshLambertMaterial();const mesh=new THREE.Mesh(g,m);mesh.rotation.y=-Math.PI/2;mesh.position.y=.8;mesh.castShadow=true;mesh.receiveShadow=true;scene.add(mesh);});
 window.addEventListener('resize',resize);
 const gui=new GUI();
 const params={type:'procedural',color:projectorLight.color.getHex(),intensity:projectorLight.intensity,distance:projectorLight.distance,angle:projectorLight.angle,penumbra:projectorLight.penumbra,decay:projectorLight.decay,focus:projectorLight.shadow.focus,shadows:true};
 let videoTexture,mapTexture;const focus=gui.add(params,'focus',0,1).onChange(v=>{projectorLight.shadow.focus=v;});
 gui.add(params,'type',['procedural','video','texture']).onChange(val=>{projectorLight.colorNode=null;projectorLight.map=null;if(val==='procedural'){projectorLight.colorNode=causticEffect;focus.setValue(1);}else if(val==='video'){if(videoTexture===undefined){const video=document.getElementById('video');video.play();videoTexture=new THREE.VideoTexture(video);videoTexture.colorSpace=THREE.SRGBColorSpace;}projectorLight.map=videoTexture;focus.setValue(.46);}else if(val==='texture'){mapTexture=loader.load('https://threejs.org/examples/textures/uv_grid_opengl.jpg');mapTexture.minFilter=THREE.LinearFilter;mapTexture.magFilter=THREE.LinearFilter;mapTexture.generateMipmaps=false;mapTexture.colorSpace=THREE.SRGBColorSpace;projectorLight.map=mapTexture;focus.setValue(1);}});
 gui.addColor(params,'color').onChange(v=>projectorLight.color.setHex(v));
 gui.add(params,'intensity',0,500).onChange(v=>projectorLight.intensity=v);
 gui.add(params,'distance',0,20).onChange(v=>projectorLight.distance=v);
 gui.add(params,'angle',0,Math.PI/3).onChange(v=>projectorLight.angle=v);
 gui.add(params,'penumbra',0,1).onChange(v=>projectorLight.penumbra=v);
 gui.add(params,'decay',1,2).onChange(v=>projectorLight.decay=v);
 gui.add(params,'shadows').onChange(v=>{renderer.shadowMap.enabled=v;scene.traverse(child=>{if(child.material) child.material.needsUpdate=true;});});
 gui.open();
}
function resize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);} 
function animate(){const t=performance.now()/3000;stats.update();projectorLight.position.x=Math.cos(t)*2.5;projectorLight.position.z=Math.sin(t)*2.5;lightHelper.update();renderer.render(scene,camera);} 
</script>
</body></html>
